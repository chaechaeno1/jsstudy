<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Ag-Grid Basic Example</title>
    <style>
        #wrapper {
            width: 650px;
            height: 500px;
            margin: 50px auto;
            text-align: center;
        }

        #myGrid {
            height: 100%;
        }

        /* í—¤ë” í…ìŠ¤íŠ¸ ê°€ìš´ë° ì •ë ¬ ìœ„í•¨ */
        .centered {
            .ag-header-cell-label {
                justify-content: center !important;
            }
        }
    </style>
   <!--  <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-enterprise/dist/ag-grid-enterprise.min.js"></script>
</head>

<body>
    <div id="wrapper">
        <h1>AG-Grid ê½¤ ì˜ ë§Œë“¤ì—ˆì–´ìš©</h1>
        <div id="myGrid" class="ag-theme-alpine">
        </div>
        <button onclick="fExp()">ë‚´ë³´ë‚´ê¹…</button>
    </div>
    <script>
        const columnDefs = [
            { field: "name", headerName: "ì´ë¦„", sortable: true },
            { field: "alias", headerName: "ë³„ëª…", sortable: true, cellStyle: { textAlign: "left" } },
            { field: "strong", headerName: "ì¥ì ", cellStyle: { textAlign: "left" } },
            { field: "weak", headerName: "ë‹¨ì ", cellStyle: { textAlign: "left" } },
            { field: "birth", headerName: "ìƒì¼", cellRenderer: MyComp } //ìƒì¼ì€ ë‚ ì§œ!
        ];

        // ì¼ë‹¨ ë¹ˆ ë°ì´í„° ì„¤ì •(ì´ˆê¸°ê°’), ì„¤ì • ì•ˆí•˜ë©´ ì£¼êµ¬ì°½ì°½ ë¡œë”©ì¤‘ ë©”ì„¸ì§€
        const rowData = [];

        // ì„¤ì • ì˜µì…˜: ì¤‘ìš”, ìœ„ì— ì •ì˜í•œ ê²ƒë“¤ì´ ì—¬ê¸°ì„œ í†µí•©ë¨ì— ì£¼ëª©
        const gridOptions = {
            columnDefs: columnDefs,
            rowData: rowData,
            defaultColDef: {
                flex: 1,       // ìë™ìœ¼ë¡œ ê°™ì€ ì‚¬ì´ì¦ˆë¡±
                filter: true,
                resizable: true,
                minWidth: 100,
                headerClass: "centered"

            },
            // í˜ì´ì§€ ì„¤ì •
            pagination: true,
            //paginationAutoPageSize:true,
            paginationPageSize: 5,    // ê°™ì´ ì„¤ì •í•˜ë‹ˆ ìœ„ì— êº¼ ìš°ì„ ìˆœìœ„

            // ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ê°€ ì œê³µë˜ì§€ë§Œ, ê·¸ ì¤‘ ë§ì´ ì“°ê²Œ ë˜ëŠ” ê²ƒ
            onCellClicked: function (params) {
                //onCellClicked: params => {
                console.log('cell was clicked', params);
                //alert("í´ë¦­í•˜ì‹  ê°’ì€: " + params.value); //ìš”ê²Œ ìˆìŒ ë­”ê°€? ë°©í•´ë¨
            }
        };

        function getData() {
            var xhr = new XMLHttpRequest();
            xhr.open("get", "dummyData.json", true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    // ë°ì´íƒ€ êµ¬ì¡° ì–µì§€ ë•œë¹µ!
                    let rslt = JSON.parse(xhr.responseText);

                    //ê·¸ëƒ¥ ìƒì¼ ëœë¤í•˜ê²Œ ë„£ê¸°!
                    for (let i = 0; i < rslt.length; i++) {
                        rslt[i].birth = ranDate();
                    }


                    //gridOptions.api.setRowData(rslt); //ì‚¬ìš© ì§€ì–‘...
                    gridOptions.api.updateGridOptions({ rowData: rslt }); //ğŸ’¥ì¤‘ìš”ğŸ’¥, ì™¸ìš°ë¼ëŠ” ê±´ ì•„ë‹ˆê³  ìì£¼ ì“°ì„
                    //gridOptions.api.setGridOptions(rowData,rslt); //ğŸ’¥ì¤‘ìš”ğŸ’¥, (ì´ ì½”ë“œëŠ” ì•„ë‹ˆê³  ë¬´íŠ¼.. í˜¼ìš©ë˜ëŠ” ì½”ë“œ ì°¾ì•„ì•¼í•¨)ì™¸ìš°ë¼ëŠ” ê±´ ì•„ë‹ˆê³  ìì£¼ ì“°ì„
                }
            }
            xhr.send();
        }

         
        // csv ë‚´ë³´ë‚´ê¸°, ë³„ë¡œ ì•ˆ ì¤‘ìš”, ê·¸ëƒ¥ ì´ëŒ€ë¡œ ì„¤ì •í•˜ê³  ê°’ë§Œ ê³ ì¹˜ë©´ ë¨
        function fExp(){
            var v_params = {
                suppressQuotes: "true",                 // none, true
                columnSeparator: "   ",                 // defaultê°’ì´ ,
                customHeader: "ì´ë¦„ ë³„ëª… ì¥ì  ë‹¨ì ",    // í—¤ë”ëª… ì¶”ê°€ ì¶œë ¥
                customFooter: "ì´ê±°ìŠ¨ í‘¸í„°"             // ë°ì´íƒ€ ì•„ë˜ì— footerì¶”ê°€
            };
            gridOptions.api.exportDataAsCsv(v_params);
        } 


        // ê·¸ë¦¬ë“œ ì…‹ì—…
        document.addEventListener('DOMContentLoaded', () => {
            const gridDiv = document.querySelector('#myGrid');
            new agGrid.Grid(gridDiv, gridOptions);
            getData();  // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¹…
        });

         
        //ìƒì„±ì
        function MyComp() {
            return this;
        }
        

        // ğŸ’¥ğŸ’¥ğŸ’¥AG-GRID ë¬¸ì„œì— ë‚˜ì˜¤ëŠ” ì»¤ìŠ¤í…€ Cell RendererğŸ’¥ğŸ’¥ğŸ’¥
        MyComp.prototype.init = function (params) {
            this.eGui = document.createElement('div');
            this.eGui.innerHTML = `
                    <input type="date" value="" class="myCal" style="border:0px;width:0px"> 
                    <span class="mySpan">${params.value}</span> 
                `;

            this.myCal = this.eGui.querySelector('.myCal')
            this.mySpan = this.eGui.querySelector('.mySpan')
            this.mySpan.onclick = () => {
                this.myCal.showPicker();
            }
            this.myCal.onchange = () => {
                console.log("check", this.myCal.value);
                this.mySpan.innerHTML = this.myCal.value;
            }
        }
        MyComp.prototype.getGui = function () {
            console.log("check1");
            return this.eGui;
        }

        MyComp.prototype.refresh = function () {
            console.log("check2");
            return true;

        }

        MyComp.prototype.destroy = function () {
            console.log("check3");
        }
        // Cell Randerer ë!



        // ìœ„ì—ì„œ ì–¸ê¸‰í•œ ranDate()
        function ranDate() {
            let now = new Date();
            now.setDate(now.getDate() - Math.floor(Math.random() * 90));

            let rYear = now.getFullYear();

            let rMonth = now.getMonth() + 1;
            if (rMonth < 10) rMonth = "0" + rMonth;

            let rDate = now.getDate();
            if (rDate < 10) rDate = "0" + rDate;

            return `${rYear}-${rMonth}-${rDate}`;
        }

    </script>
</body>

</html>