<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>

<script src="./jsp.js"></script>    

<style>
    .active{
        color: red;
        font-size: 2em; /* 2배 */
    }
</style>

</head>
<body>
    <h1>못생긴 게시판</h1>
    <div id="list"></div>
<script>
    function f_over(pThis) {
        pThis.style.backgroundColor = "pink";
    }
    function f_out(pThis) {
        pThis.style.backgroundColor = "white";
    }

    

    const myList = document.querySelector("#list");
    const tblName = "myGesi";
    var gulList = JSON.parse(localStorage.getItem(tblName));    // 배열

    // pid 순으로 뒤집기
    gulList.sort(function(a,b){
        return b.pid-a.pid;
    });
    
    //--------------------------------------------------------------------
    
    /*
    페이지 나누기 산수임!!
    - 전체 글 수
    - 한 페이지당 글 몇개
    - 현재페이지
    - 페이지 수
    */

    var pagePerGul = 10; //페이지 당 글 수
    var totalGul = gulList.length; //배열의 길이(전체 글 수)
    // 전체 글 수가 108개일 때, 10으로 나누면 10.8... 페이지는 11개가 되어야 함
    var totalPage = Math.ceil(totalGul / pagePerGul); //나머지가 있으면 무조건 1페이지 더 있음!!
   
    var curPage = 1; //일단 디폴트로 첫 페이지를 현재 페이지로 출력
    if(request.getParameter("page")){ //넘어온 값이 있다면
        curPage = request.getParameter("page"); //그 값으로 현재페이지를 세팅
    }

    //1페이지는 0~9, 2페이지는 10~19 ....
    var startIndex = (curPage-1) * pagePerGul; // 0, 10, 20, 30...
    var endIndex = startIndex + pagePerGul;

    // 마지막 페이지는 항상 10개라고 볼 수 없고, 1개만 있을수도 있음
    if(endIndex > (gulList.length)){ // 배열의 마지막 index보다 크다면, 그건 없으니까
        endIndex = gulList.length;   // endIndex를 배열의 마지막 index값으로 바꿔준다.
    }
   
   
   //--------------------------------------------------------------------




    var tblStr = "<table border=1>";
        tblStr += "<tr><th>PID</th><th>제목</th><th>글쓴이</th><th>스킬</th></tr>";
    
    for(var i=startIndex; i<endIndex; i++) {
        console.log("체크 :", i);
        var gul = gulList[i];
        tblStr += `
                    <tr onmouseover=f_over(this) onmouseout=f_out(this)>
                        <td>${gul.pid}</td>
                        <td>${gul.title}</td>
                        <td>${gul.writer}</td>
                        <td>${gul.skills}</td>
                    </tr>
        `;
    }
    tblStr += "</table><br>";

    //페이지 리스트 출력
    for(var i=1; i<totalPage; i++){
        if(curPage==i){
            tblStr += `<a class="active" href="list.html?page=${i}">${i}</a>&nbsp;&nbsp;&nbsp;`;
        }else{
            tblStr += `<a href="list.html?page=${i}">${i}</a>&nbsp;&nbsp;&nbsp;`;
        }
    }

    tblStr += "<br><a href=write.html>글쓰기</a>";  // 글쓰기로 가는 a 링크 괜히 넣기
    myList.innerHTML = tblStr;

</script>
</body>
</html>